--000179

-- Ö²Îï´óÕ½½©Ê¬

--************************************************************************
--MisDescBegin
--½Å±¾ºÅ
x000179_g_ScriptId = 000179
x000179_g_Name = "Cüa ngß½i ÁÚ¾Ó"


--MisDescEnd
--************************************************************************
x000179_TIME_2000_01_03_ = 946828868

x000179_g_SceneData_1 = 8   -- ¼ÇÂ¼¸±±¾Ë¢¹Öµ½µÚ¼¸Åú

x000179_g_SceneData_3 = 9	-- 
x000179_g_SceneData_4 = 10	-- 
x000179_g_SceneData_5 = 11	-- 
x000179_g_SceneData_6 = 12	-- 

x000179_g_SceneData_7 = 13	-- Íæ¼ÒµÈ¼¶

x000179_g_SD_Monster_1 	 = 14			-- ÔİÎ´Ê¹ÓÃ
x000179_g_SD_Monster_1_T = 15			-- ÔİÎ´Ê¹ÓÃ


x000179_g_SD_Monster_2 	 = 16
x000179_g_SD_Monster_2_T = 17
x000179_g_SD_Monster_3 	 = 18
x000179_g_SD_Monster_3_T = 19

x000179_g_KillMonsCount_Qincheng = 20
x000179_g_KillMonsCount_Qinjia 	 = 21
x000179_g_KillMonsCount_Lama		 = 22

x000179_g_SkillSign = 23 	-- ¹«Ò±¸É¡¢µË°Ù´¨¡¢°ü²»Í¬ºÍ·ç²¨¶ñ ÆäÖĞmµt cáiÈËËÀºó,±ğÈË¿ñ±©±ê¼Ç

-- ÍõÓïÑÔ¿ªÊ¼ ği¬mÃûtoÕ ğµ ¿ª¹Ø
x000179_g_bWangyuyanSpeak = 24
x000179_g_bWangyuyanSpeak_T = 27

-- ¹Ø±Õ¸±±¾toÕ ğµ Ê±¼ä¼ÇÂ¼
x000179_g_CloseTime = 25

-- ¸±±¾th¤t bÕitoÕ ğµ ±ê¼Ç
x000179_g_MissionLost = 26

-- ¿ØÖÆH® th¯ngÌáÊ¾toÕ ğµ Ê±¼ä
x000179_g_SystemTipsTime = 28

-- ¿ØÖÆ ÍõÓïæÌÊÜµ½ÉËº¦ºó,ÍõÓïæÌºÍĞoàn DñtoÕ ğµ ¶Ô»°
x000179_g_DuanAndWangFlag = 29

--¸±±¾Ãû³Æ
x000179_g_CopySceneName = "Ö²Îï´óÕ½½©Ê¬"
x000179_g_CopySceneType = FUBEN_ZHIWU_JS	--¸±±¾ÀàĞÍ,¶¨ÒåTÕi ScriptGlobal.luaÀïÃæ
x000179_g_CopySceneMap = "zombies.nav"
x000179_g_LimitMembers = 1				--¿ÉÒÔ½ø¸±±¾toÕ ğµ ×îĞ¡¶ÓÎéÈËÊı
x000179_g_TickTime = 1						--»Øµ÷½Å±¾toÕ ğµ Ê±ÖÓÊ±¼ä(µ¥Î»:  giây/´Î)
x000179_g_LimitTotalHoldTime = 360--¸±±¾¿ÉÒÔ´æ»îtoÕ ğµ Ê±¼ä(µ¥Î»: ´ÎÊı),Èç¹û´ËÊ±¼äµ½ÁË,ÔòÈÎÎñ½«»áth¤t bÕi
x000179_g_LimitTimeSuccess = 500	--¸±±¾Ê±¼äÏŞÖÆ(µ¥Î»: ´ÎÊı),Èç¹û´ËÊ±¼äµ½ÁË,ÈÎÎñÍê³É
x000179_g_CloseTick = 3						--¸±±¾¹Ø±ÕÇ°µ¹¼ÆÊ±(µ¥Î»: ´ÎÊı)
x000179_g_NoUserTime = 300				--¸±±¾ÖĞÃ»ÓĞÈËºó¿ÉÒÔ¼ÌĞø±£´ætoÕ ğµ Ê±¼ä(µ¥Î»:  giây)
x000179_g_DeadTrans = 0						--ËÀÍö×ªÒÆÄ£Ê½,0: ËÀÍöºó»¹¿ÉÒÔ¼ÌĞøTÕi ¸±±¾,1: ËÀÍöºó±»Ç¿ÖÆÒÆ³ö¸±±¾
x000179_g_Fuben_X = 46						--½øÈë¸±±¾toÕ ğµ Î»ÖÃX
x000179_g_Fuben_Z = 64						--½øÈë¸±±¾toÕ ğµ Î»ÖÃZ
x000179_g_Back_X = 282							--Ô´³¡¾°Î»ÖÃX
x000179_g_Back_Z = 245						--Ô´³¡¾°Î»ÖÃZ
x000179_g_Back_SceneId = 2				--Ô´³¡¾°Id

x000179_g_Npc_1 = {	
-- ËÎ¾üÊ¿±ø
--{id=9210,x=56,y=44,camp=109,ai=21,af=222},{id=9210,x=56,y=48,camp=109,ai=21,af=222},
--{id=9210,x=56 ,y=52 ,camp=109,ai=21,af=222},{id=9210,x=56,y=56,camp=109,ai=21,af=222},
{id=9210,x=56 ,y=60 ,camp=109,ai=21,af=222},{id=9210,x=56,y=64,camp=109,ai=21,af=222},
{id=9210,x=56 ,y=68 ,camp=109,ai=21,af=222},{id=9210,x=56,y=72,camp=109,ai=21,af=222},
{id=9210,x=56 ,y=76 ,camp=109,ai=21,af=222},{id=9210,x=56,y=80,camp=109,ai=21,af=222},
{id=9210,x=56 ,y=84 ,camp=109,ai=21,af=222},{id=9210,x=56,y=88,camp=109,ai=21,af=222},
{id=9210,x=63 ,y=88 ,camp=109,ai=21,af=222},{id=9210,x=63,y=84,camp=109,ai=21,af=222},
{id=9210,x=63 ,y=80 ,camp=109,ai=21,af=222},{id=9210,x=63 ,y=76,camp=109,ai=21,af=222},
{id=9210,x=63 ,y=72 ,camp=109,ai=21,af=222},{id=9210,x=63 ,y=68,camp=109,ai=21,af=222},
{id=9210,x=63 ,y=64 ,camp=109,ai=21,af=222},{id=9210,x=63 ,y=60,camp=109,ai=21,af=222},
{id=9210,x=63 ,y=56 ,camp=109,ai=21,af=222},{id=9210,x=63 ,y=52,camp=109,ai=21,af=222},
{id=9210,x=63 ,y=48 ,camp=109,ai=21,af=222},{id=9210,x=63,y=44,camp=109,ai=21,af=222},
{id=9210,x=63,y=40,camp=109,ai=21,af=222},
-- mµt Æ·ÌÃÎäÊ¿
{id=9240,x=68,y=46,camp=110,ai=21,af=226},{id=9240,x=68,y=54,camp=110,ai=21,af=226},
{id=9240,x=68,y=60,camp=110,ai=21,af=226},{id=9240,x=68,y=67,camp=110,ai=21,af=226},
{id=9240,x=68,y=73,camp=110,ai=21,af=226},{id=9240,x=68,y=78,camp=110,ai=21,af=226},
{id=9240,x=67,y=84,camp=110,ai=21,af=226},{id=9240,x=65,y=73,camp=110,ai=21,af=226},
{id=9240,x=65 ,y=63,camp=110,ai=21,af=226},{id=9240,x=65 ,y=52,camp=110,ai=21,af=226},
{id=9240,x=60 ,y=58,camp=110,ai=21,af=226},{id=9240,x=60 ,y=66,camp=110,ai=21,af=226},
{id=9240,x=60 ,y=77,camp=110,ai=21,af=226},

-- Ñà×ÓÎë×¯¶¡
{id=9280,x=73,y=85 ,camp=110,ai=21,af=239},{id=9280,x=73,y=81 ,camp=110,ai=21,af=239},
{id=9280,x=73,y=77 ,camp=110,ai=21,af=239},{id=9280,x=73,y=73 ,camp=110,ai=21,af=239},
{id=9280,x=73,y=68 ,camp=110,ai=21,af=239},{id=9280,x=73,y=64 ,camp=110,ai=21,af=239},
{id=9280,x=73,y=60 ,camp=110,ai=21,af=239},{id=9280,x=73,y=56 ,camp=110,ai=21,af=239},
{id=9280,x=73,y=52 ,camp=110,ai=21,af=239},{id=9280,x=73,y=48 ,camp=110,ai=21,af=239},
{id=9280,x=73,y=44 ,camp=110,ai=21,af=239},{id=9280,x=73,y=40 ,camp=110,ai=21,af=239},

-- Á¬åóËş
{id=9290,x=87,y=82 ,camp=110,ai=21,af=223},{id=9290,x=87,y=69 ,camp=110,ai=21,af=223},
{id=9290,x=87,y=56 ,camp=110,ai=21,af=223},{id=9290,x=87,y=43 ,camp=110,ai=21,af=223},
}

-- ºôÑÓÇì ºôÑÓ±ª
x000179_g_Npc_2 = {	{id=9200,x=40,y=63,script=402240,camp=0,ai=3,af=-1},
									 	{id=9220,x=40, y=67,script=402241,camp=109,ai=21,af=220}
}

-- ºôÑÓÇìÉíºóÓĞ¶Ô»°toÕ ğµ ËÎ±ø
x000179_g_Npc_2_1={	{id=9210,x=43,y=57,camp=109,ai=21,af=222,script=402262},
										{id=9210,x=43,y=60,camp=109,ai=21,af=222,script=402262},
										{id=9210,x=43,y=69,camp=109,ai=21,af=222,script=402262},
										{id=9210,x=43,y=73,camp=109,ai=21,af=222,script=402262},
}

-- ÔÀÀÏÈı
x000179_g_Npc_3 = {	{id=9340,	x=52,y=67,	script=402242,camp=110,ai=21,af=227}
}

-- ÔÀÀÏÈı ¸½´øtoÕ ğµ Ğ¡¹Ö (mµt Æ·ÌÃÎäÊ¿)
x000179_g_Npc_3_1={	{id=9240,x=54,y=61,camp=110,ai=21,af=226},
										{id=9240,x=54,y=64,camp=110,ai=21,af=226},
										{id=9240,x=54,y=67,camp=110,ai=21,af=226},
										{id=9240,x=54,y=70,camp=110,ai=21,af=226},
}

-- Ò¶¶şÄï ÔÆÖĞº×
x000179_g_Npc_4 = {	{id=9330,x=58,y=75,script=402244,camp=110,ai=21,af=228},
										{id=9350,x=61,y=70,script=402243,camp=110,ai=21,af=229},
}                                                
                                                 
-- ¶ÎÑÓÇì
x000179_g_Npc_5 = {	{id=9320,x=50,y=65,script=402245,camp=110,ai=21,af=230},
}

-- Ç®ºêÓî »ªºÕôŞ
x000179_g_Npc_6 = {	{id=9230,x=40,y=71,script=402246,camp=109,ai=21,af=221},
										{id=9480,x=40,y=59	,script=402249,camp=0,ai=3,af=-1},
}

-- ¿ÉÒÔÓÉÍæ¼ÒĞŞÀítoÕ ğµ Á¬åóËş
x000179_g_Npc_7 = {	{id=9290,x=38,y=80,script=402247, name="Ç°",camp=0,ai=3,af=-1},
										{id=9290,x=38,y=69,script=402247, name="ºó",camp=0,ai=3,af=-1},
										{id=9300,x=38,y=58,script=402247, name="",camp=0,ai=3,af=-1},
										{id=9310,x=38,y=47,script=402247, name="",camp=0,ai=3,af=-1},
}

-- ºÍ ºôÑÓ±ª ¶Ô»°ºó,²»¶ÏÊä³ötoÕ ğµ Ğ¡¹Ö (mµt Æ·ÌÃÎäÊ¿)
x000179_g_Npc_8 = {	{id=9240,x=58,y=62,script=-1,camp=110,ai=21,af=226},
										{id=9240,x=60,y=59,script=-1,camp=110,ai=21,af=226},
										{id=9240,x=61,y=62,script=-1,camp=110,ai=21,af=226},
										{id=9240,x=62,y=67,script=-1,camp=110,ai=21,af=226},
}

-- ºÍÇ®ºêÓî¶Ô»°ºó,²»¶ÏË¢³ötoÕ ğµ Ğ¡¹Ö
x000179_g_Npc_9 = {	{id=9250,x=83,y=58,script=402258,pp=0,camp=110,ai=21,af=231},
										{id=9250,x=83,y=61,script=402258,pp=1,camp=110,ai=21,af=231},
										{id=9250,x=83,y=64,script=402258,pp=2,camp=110,ai=21,af=231},
										{id=9250,x=83,y=67,script=402258,pp=3,camp=110,ai=21,af=231},
										{id=9250,x=83,y=70,script=402258,pp=4,camp=110,ai=21,af=231},
}

-- Ä¾ÈË¿şÀÜTÕi  Ë«Êı´ÎË¢
x000179_g_Npc_9_1={	{id=9530,x=82,y=55,script=402259,pp=4,camp=110,ai=21,af=233}}

-- Çà³ÇÅÉµÜ×Ó,TÕi 50µ½100Ë¢³ö
x000179_g_Npc_9_2 = {	
										{id=9260,x=83,y=57,script=402257,pp=0,camp=110,ai=21,af=232},
										{id=9260,x=83,y=60,script=402257,pp=1,camp=110,ai=21,af=232},
										{id=9260,x=83,y=63,script=402257,pp=2,camp=110,ai=21,af=232},
										{id=9260,x=83,y=66,script=402257,pp=3,camp=110,ai=21,af=232},
										{id=9260,x=83,y=69,script=402257,pp=4,camp=110,ai=21,af=232},
}

-- ºÍÇ®ºêÓî¶Ô»°ºó,²»¶ÏË¢³ötoÕ ğµ  ÍÂŞ¬À®Âï
x000179_g_Npc_10= {	{id=9270,x=81,y=53,script=402260,pp=0,camp=110,ai=21,af=234},
										{id=9270,x=81,y=56,script=402260,pp=1,camp=110,ai=21,af=234},
										{id=9270,x=81,y=59,script=402260,pp=2,camp=110,ai=21,af=234},
										{id=9270,x=81,y=62,script=402260,pp=2,camp=110,ai=21,af=234},
										{id=9270,x=81,y=65,script=402260,pp=2,camp=110,ai=21,af=234},
}

-- ºÍÇ®ºêÓî¶Ô»°ºó,Ò¦²®µ±,Ë¾ÂíÁÖ,Cßu Ma Trí (Cßu Ma Trí ÓĞ½Å±¾)
x000179_g_Npc_11= {	{id=9360,x=81,y=57,script=402248,pp=0,camp=110,ai=21,af=235},
										{id=9370,x=81,y=60,script=402248,pp=0,camp=110,ai=21,af=236},
										{id=9380,x=81,y=63,script=402248,pp=0,camp=110,ai=21,af=237},
}

x000179_g_Npc_12= {	{id=9390,x=82,y=60,script=402250,camp=110,ai=21,af=241},
										{id=9400,x=82,y=63,script=402251,camp=110,ai=21,af=241},
										{id=9410,x=82,y=66,script=402252,camp=110,ai=21,af=241},
										{id=9420,x=82,y=69,script=402253,camp=110,ai=21,af=241},
}

-- Mµ Dung Phøc
x000179_g_Npc_13 ={	{id=9430,x=64,y=61,	script=402254,camp=110,ai=25,af=244},
}

-- Íõ¹ÃÄï,Ğoàn Dñ µÈÈË
x000179_g_Npc_14= {	{id=9450,x=67,y=56,	script=402255,camp=0,ai=26,af=-1},
										{id=9440,x=67,y=58,	script=402256,camp=0,ai=27,af=245},
										{id=9460,x=67,y=60,	script=402249,camp=0,ai=27,af=247},
										{id=9470,x=67,y=62,	script=402249,camp=0,ai=27,af=248},
										{id=9490,x=67,y=64,	script=402249,camp=0,ai=27,af=249},
										{id=9500,x=67,y=66,	script=402249,camp=0,ai=27,af=250},
										{id=9510,x=67,y=68,	script=402249,camp=0,ai=27,af=251},
										{id=9520,x=67,y=70,	script=402249,camp=0,ai=27,af=252},
}

x000179_g_Npc_15=	{	}

x000179_g_Npc_16=	{	}

--**********************************
--ÈÎÎñÈë¿Úº¯Êı
--**********************************
function x000179_OnDefaultEvent( sceneId, selfId, targetId )
	
	if GetNumText() == 1   then
		BeginEvent(sceneId)
			AddText(sceneId,"ÈçÒâĞ¡×ÓtoÕ ğµ Ö²Îï´óÕ½½©Ê¬");
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
		return
	end
	
	if GetName(sceneId, targetId) ~= x000179_g_Name  then
		return
	end

	-- ¸ù¾İÍæ¼ÒtoÕ ğµ Çé¿ö,½«Íæ¼ÒËÍµ½²»Í¬toÕ ğµ ¸±±¾
	-- 2,¼ì²âÍæ¼ÒĞúng²»Ğúng×é¶ÓÁË
	if GetTeamSize(sceneId,selfId) < 1  then
		BeginEvent(sceneId)
			AddText(sceneId,"#B½øÈëÖ²Îï´óÕ½½©Ê¬»á³¡");
			AddText(sceneId,"  ´ËÕ½Ğ×ÏÕÒì³£,²»×ã3ÈËÎÒ¿É²»¸ÒÈÃÄãÃÇ½øÈë.");
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
		return
	end

	-- 3,¼ì²âÍæ¼ÒĞúng²»Ğúng¶Ó³¤
	if GetTeamLeader(sceneId,selfId) ~= selfId    then
		BeginEvent(sceneId)
			AddText(sceneId,"#B½øÈëÖ²Îï´óÕ½½©Ê¬»á³¡");
			AddText(sceneId,"  Äã±ØĞëĞúng¶Ó³¤²ÅĞĞ.");
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
		return
	end

	-- 4,¼ì²âĞúng²»ĞúngÈË¶¼µ½Î»ÁË
	if GetTeamSize(sceneId,selfId) ~= GetNearTeamCount(sceneId,selfId)  then
		BeginEvent(sceneId)
			AddText(sceneId,"#B½øÈëÖ²Îï´óÕ½½©Ê¬»á³¡");
			AddText(sceneId,"  »¹ÓĞĞµi viên ²»TÕi ¸½½ü.");
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
		return
	end

	--5,¼ì²â¶ÓÎéÀïÍ·toÕ ğµ Ã¿cáiÍæ¼ÒĞúng²»Ğúng¶¼µ½60¼¶ÁË
	local nPlayerNum = GetNearTeamCount(sceneId,selfId)

	for i=0, nPlayerNum-1  do
		local nPlayerId = GetNearTeamMember(sceneId,selfId, i)
		
		if GetLevel(sceneId,nPlayerId) < 60  then
			BeginEvent(sceneId)
				AddText(sceneId,"#B½øÈëÖ²Îï´óÕ½½©Ê¬»á³¡");
				AddText(sceneId,"  ´ËÕ½Ğ×ÏÕÒì³£,²»×ã60¼¶ÎÒ¿É²»¸ÒÈÃÄãÃÇ½øÈë.");
			EndEvent(sceneId)
			DispatchEventList(sceneId,selfId,targetId)
			
			return
		end
	end

	local strName = {}
	strName[1] = ""
	strName[2] = ""
	strName[3] = ""
	strName[4] = ""
	strName[5] = ""
	strName[6] = ""

	local nPlayerNum = GetNearTeamCount(sceneId,selfId)
	local bOk = 1
	for i=0, nPlayerNum-1  do
		local nPlayerId = GetNearTeamMember(sceneId,selfId, i)
		
		local nTimes = GetMissionData(sceneId,nPlayerId, MD_JIANGSHI_TIMES) 
		local nPreTime = GetMissionData(sceneId,nPlayerId, MD_PRE_JIANGSHI_TIME)
		local nCurTime = LuaFnGetCurrentTime()
		if (nCurTime - nPreTime  >= 3600*24)  or
			 (floor((nCurTime-x000179_TIME_2000_01_03_)/(3600*24)) ~= floor((nPreTime-x000179_TIME_2000_01_03_)/(3600*24)))   then
			nTimes = 0
			nPreTime = nCurTime
			SetMissionData(sceneId, nPlayerId, MD_JIANGSHI_TIMES, nTimes)
			SetMissionData(sceneId, nPlayerId, MD_PRE_JIANGSHI_TIME, nPreTime)
		end
		
		if nTimes >= 10  then
			bOk = 0
			strName[i+1] = GetName(sceneId, nPlayerId)
		end
		
	end
	local nCount = 0

	if bOk == 0  then
		local szAllName = ""
		for i=1, 6  do
			if strName[i] ~= ""  then
				if nCount == 0  then
					szAllName = strName[i]
				else
					szAllName = szAllName .. "¡¢" .. strName[i]
				end
				nCount = nCount+1
			end
		end
		BeginEvent(sceneId)
			AddText(sceneId,"#B½øÈëÖ²Îï´óÕ½½©Ê¬»á³¡");
			AddText(sceneId,"  Cüa ngß½i ¶ÓÎéÖĞ" .. szAllName .. "½ñÌìÒÑ¾­²Î¼Ó¹ı3´ÎÖ²Îï´óÕ½½©Ê¬.");
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
		return
	
	end
	
	-- ËùÓĞtoÕ ğµ ¼ì²âÍ¨¹ı,
	x000179_MakeCopyScene(sceneId, selfId)
	
	BeginUICommand(sceneId)
	EndUICommand(sceneId)
	DispatchUICommand(sceneId,selfId, 1000)
	
end

--**********************************
--ÁĞ¾ÙÊÂ¼ş
--**********************************
function x000179_OnEnumerate( sceneId, selfId, targetId )
	-- ×îºÃTÕi ÕâÀï×ömµt cáiTênÅĞ¶¨
	if GetName(sceneId, targetId) == x000179_g_Name  then
		AddNumText( sceneId, x000179_g_ScriptId, "½øÈëÖ²Îï´óÕ½½©Ê¬»á³¡",10 ,-1  )
	end
end

--**********************************
--¼ì²âTiªp thøÌõ¼ş
--**********************************
function x000179_CheckAccept( sceneId, selfId )
	
end

--**********************************
--Ñ¯ÎÊÍæ¼ÒĞúng·ñÒª½øÈë¸±±¾
--**********************************
function x000179_AskEnterCopyScene( sceneId, selfId )
	
end

--**********************************
--Tiªp thø
--**********************************
function x000179_OnAccept( sceneId, selfId, targetId )
	
end

--**********************************
--Íæ¼ÒÍ¬Òâ½øÈë¸±±¾
--**********************************
function x000179_AcceptEnterCopyScene( sceneId, selfId )
	
end

--**********************************
--´´½¨¸±±¾
--**********************************
function x000179_MakeCopyScene( sceneId, selfId )
	
	-- Ê¹ÓÃĞµi viên toÕ ğµ µÈ¼¶À´Ëã³ö¹ÖÎïtoÕ ğµ µÈ¼¶
	local param0 = 4;
	local param1 = 3;

	--×îÖÕ½á¹û
	local mylevel = 0;

	--ÁÙÊ±±äÁ¿
	local memId;
	local tempMemlevel = 0;
	local level0 = 0;
	local level1 = 0;
	local i;
	
	local nearmembercount = GetNearTeamCount(sceneId,selfId)
	for	i = 0, nearmembercount - 1 do
		memId = GetNearTeamMember(sceneId, selfId, i);
		tempMemlevel = GetLevel(sceneId, memId);
		level0 = level0 + (tempMemlevel ^ param0);
		level1 = level1 + (tempMemlevel ^ param1);
	end
	
	if level1 == 0 then
		mylevel = 0
	else
		mylevel = level0/level1;
	end
	
	if nearmembercount == -1  then  --Ã»ÓĞ¶ÓÎé
		mylevel = GetLevel(sceneId, selfId)
	end
	
	leaderguid=LuaFnObjId2Guid(sceneId,selfId)
	LuaFnSetSceneLoad_Map(sceneId, "zombies.nav"); --µØÍ¼Ğúng±ØĞëÑ¡È¡toÕ ğµ ,¶øÇÒ±ØĞëTÕi Config/SceneInfo.iniÀïÅäÖÃºÃ
	LuaFnSetCopySceneData_TeamLeader(sceneId, leaderguid);
	LuaFnSetCopySceneData_NoUserCloseTime(sceneId, x000179_g_NoUserTime*1000);
	LuaFnSetCopySceneData_Timer(sceneId, x000179_g_TickTime*1000);
	LuaFnSetCopySceneData_Param(sceneId, 0, x000179_g_CopySceneType);--ÉèÖÃ¸±±¾Êı¾İ,ÕâÀï½«0ºÅË÷ÒıtoÕ ğµ Êı¾İÉèÖÃÎª999,ÓÃÓÚ±íÊ¾¸±±¾ºÅ999(Êı×Ö×Ô¶¨Òå)
	LuaFnSetCopySceneData_Param(sceneId, 1, x000179_g_ScriptId);--½«1ºÅÊı¾İÉèÖÃÎª¸±±¾³¡¾°ÊÂ¼ş½Å±¾ºÅ
	LuaFnSetCopySceneData_Param(sceneId, 2, 0);		--ÉèÖÃ¶¨Ê±Æ÷µ÷ÓÃ´ÎÊı
	LuaFnSetCopySceneData_Param(sceneId, 3, -1);	--ÉèÖÃ¸±±¾Èë¿Ú³¡¾°ºÅ, ³õÊ¼»¯
	LuaFnSetCopySceneData_Param(sceneId, 4, 0);		--ÉèÖÃ¸±±¾¹Ø±Õ±êÖ¾, 0¿ª·Å,1¹Ø±Õ
	LuaFnSetCopySceneData_Param(sceneId, 5, 0);		--ÉèÖÃÀë¿ªµ¹¼ÆÊ±´ÎÊı
	LuaFnSetCopySceneData_Param(sceneId, 6, GetTeamId(sceneId,selfId)); --±£´æ¶ÓÎéºÅ
	LuaFnSetCopySceneData_Param(sceneId, 7, 0) ;	--É±ËÀBosstoÕ ğµ ÊıÁ¿
	
	-- ¾çÇéÓÃµ½toÕ ğµ ±äÁ¿Çå¿Õ
	for i=8, 31 do
		LuaFnSetCopySceneData_Param(sceneId, i, 0)
	end
	
	local PlayerMaxLevel = GetHumanMaxLevelLimit()
	local iniLevel;
	if mylevel < 10 then
		iniLevel = 1;
	elseif mylevel < PlayerMaxLevel then
		iniLevel = floor(mylevel/10);
	else
		iniLevel = 10;
	end

	-- Ê¹ÓÃµÚ13Î»,¼ÇÂ¼¹ÖÎïÊµ¼ÊtoÕ ğµ µÈ¼¶
	LuaFnSetCopySceneData_Param(sceneId, x000179_g_SceneData_7, mylevel)
	
	--ÉèÖÃ³¡¾°ÖĞtoÕ ğµ ¸÷ÖÖNpcºÍÇøÓò
	LuaFnSetSceneLoad_Area( sceneId, "zombies_area.ini" )
	LuaFnSetSceneLoad_Monster( sceneId, "zombies_monster.ini" )

	local bRetSceneID = LuaFnCreateCopyScene(sceneId); --³õÊ¼»¯Íê³Éºóµ÷ÓÃ´´½¨¸±±¾º¯Êı
	BeginEvent(sceneId)
		if bRetSceneID>0 then
			AddText(sceneId,"¸±±¾´´½¨³É¹¦!");
		else
			AddText(sceneId,"¸±±¾ÊıÁ¿ÒÑ´ïÉÏÏŞ,ÇëÉÔºòÔÙÊÔ!");
		end
	EndEvent(sceneId)
	DispatchMissionTips(sceneId,selfId)
	
end

--**********************************
--¸±±¾ÊÂ¼ş
--**********************************
function x000179_OnCopySceneReady( sceneId, destsceneId )

	--½øÈë¸±±¾toÕ ğµ ¹æÔò
	-- 1,Èç¹ûCái này ÎÄ¼şÃ»ÓĞ×é¶Ó,¾Í´«ËÍCái này Íæ¼Ò×Ô¼º½øÈë¸±±¾
	-- 2, Èç¹ûÍæ¼ÒÓĞ¶ÓÎé,µ«ĞúngÍæ¼Ò²»Ğúng¶Ó³¤,¾Í´«ËÍ×Ô¼º½øÈë¸±±¾
	-- 3,Èç¹ûÍæ¼ÒÓĞ¶ÓÎé,²¢ÇÒCái này Íæ¼ÒĞúng¶Ó³¤,¾Í´«ËÍ×Ô¼ººÍ¸½½ü¶ÓÓÑmµt Æğ½øÈ¥

	LuaFnSetCopySceneData_Param(destsceneId, 3, sceneId) --ÉèÖÃ¸±±¾Èë¿Ú³¡¾°ºÅ
	leaderguid  = LuaFnGetCopySceneData_TeamLeader(destsceneId)
	leaderObjId = LuaFnGuid2ObjId(sceneId,leaderguid)
	
	if LuaFnIsCanDoScriptLogic( sceneId, leaderObjId ) ~= 1 then			-- ´¦ÓÚÎŞ·¨Ö´ĞĞÂß¼­toÕ ğµ ×´Ì¬
		return
	end
	
	-- ¼ì²âÍæ¼ÒĞúng²»ĞúngÓĞ¶ÓÎé
	if LuaFnHasTeam( sceneId, leaderObjId ) == 0  then   -- Ã»ÓĞ¶ÓÎé
		x000179_GotoScene(sceneId, leaderObjId, destsceneId)
	else
		if IsCaptain(sceneId, leaderObjId) == 0  then
			x000179_GotoScene(sceneId, leaderObjId, destsceneId)
		else
			local	nearteammembercount = GetNearTeamCount( sceneId, leaderObjId) 
			local mems = {}
			for	i=0,nearteammembercount-1 do
				mems[i] = GetNearTeamMember(sceneId, leaderObjId, i)
				x000179_GotoScene(sceneId, mems[i], destsceneId)
			end
		end
	end

end

function x000179_GotoScene(sceneId, ObjId, destsceneId)
	NewWorld( sceneId, ObjId, destsceneId, x000179_g_Fuben_X, x000179_g_Fuben_Z) ;
end


--**********************************
--ÓĞÍæ¼Ò½øÈë¸±±¾ÊÂ¼ş
--**********************************
function x000179_OnPlayerEnter( sceneId, selfId )
	-- 3,ÉèÖ giâyÀÍöÊÂ¼ş
	
	-- ÉèÖÃÍæ¼ÒtoÕ ğµ ÕóÓªÎª 109
	SetUnitCampID(sceneId, selfId, selfId, 109)
	SetPlayerDefaultReliveInfo( sceneId, selfId, "%10", -1, "0", sceneId, x000179_g_Fuben_X, x000179_g_Fuben_Z )
	
	local nTimes = GetMissionData(sceneId,selfId, MD_JIANGSHI_TIMES) 
	local nPreTime = GetMissionData(sceneId,selfId, MD_PRE_JIANGSHI_TIME)
	local nCurTime = LuaFnGetCurrentTime()
	
	SetMissionData(sceneId, selfId, MD_JIANGSHI_TIMES, nTimes+1) 
	SetMissionData(sceneId, selfId, MD_PRE_JIANGSHI_TIME, nCurTime)
	
end

--**********************************
--ÓĞÍæ¼ÒTÕi ¸±±¾ÖĞËÀÍöÊÂ¼ş
--**********************************
function x000179_OnHumanDie( sceneId, selfId, killerId )
	
end

--**********************************
--·ÅÆú
--**********************************
function x000179_OnAbandon( sceneId, selfId )
	
end

--**********************************
--¼ÌĞø
--**********************************
function x000179_OnContinue( sceneId, selfId, targetId )
	
end	

--**********************************
--¼ì²âĞúng·ñ¿ÉÒÔÌá½»
--**********************************
function x000179_CheckSubmit( sceneId, selfId, selectRadioId )
	
end

--**********************************
--Ìá½»
--**********************************
function x000179_OnSubmit( sceneId, selfId, targetId, selectRadioId )
	
end

--**********************************
--É±ËÀ¹ÖÎï»òÍæ¼Ò
--**********************************
function x000179_OnDie( sceneId, objId, killerId )
	
end

--**********************************
--ÌáÊ¾ËùÓĞ¸±±¾ÄÚÍæ¼Ò
--**********************************
function x000179_TipAllHuman( sceneId, Str )
	--  ğÕt ğßşc³¡¾°ÀïÍ·toÕ ğµ ËùÓĞÈË
	local nHumanNum = LuaFnGetCopyScene_HumanCount(sceneId)
	
	-- Ã»ÓĞÈËtoÕ ğµ ³¡¾°,Ê²Ã´¶¼²»×ö
	if nHumanNum < 1 then
		return
	end
	
	for i=0, nHumanNum-1  do
		local PlayerId = LuaFnGetCopyScene_HumanObjId(sceneId, i)
		BeginEvent(sceneId)
			AddText(sceneId, Str)
		EndEvent(sceneId)
		DispatchMissionTips(sceneId, PlayerId)
	end
end

--**********************************
--É±ËÀ¹ÖÎï»òÍæ¼Ò
--**********************************
function x000179_OnKillObject( sceneId, selfId, objdataId, objId )
	
end

--**********************************
--½øÈëÇøÓòÊÂ¼ş
--**********************************
function x000179_OnEnterZone( sceneId, selfId, zoneId )
	
end

--**********************************
--µÀ¾ß¸Ä±ä
--**********************************
function x000179_OnItemChanged( sceneId, selfId, itemdataId )
	
end

--**********************************
--Ã¿mµt ¹ØtoÕ ğµ H® th¯ngÌáÊ¾ Ã¿¸ô15 giâyÓÉH® th¯ng·¢³öÃ¿mµt ¹ØtoÕ ğµ ÌáÊ¾ĞÅÏ¢
--**********************************
function x000179_SystemTips( sceneId, nStep )
	if nStep == 1  then
		x000179_TipAllHuman(sceneId, "ÓĞ½©Ê¬´òËãÔ¼Äã³Ô·¹")
		x000179_TipAllHuman(sceneId, "Çë×¼±¸ºÃÍí²ÍµÈËûÃÇ.....")
	elseif nStep == 2  then
		x000179_TipAllHuman(sceneId, "ÓĞ½©Ê¬¿´ÉÏÁËÄãÃÇ¶ÓÎéÖĞtoÕ ğµ Å®º¢")
		x000179_TipAllHuman(sceneId, "ÈÃÄã¸øËûÃÇ×öcáiÃ½ÈË.....")
	elseif nStep == 3  then
		x000179_TipAllHuman(sceneId, "ÓĞ½©Ê¬Ïë¼ÓÄãºÃÓÑ")
		x000179_TipAllHuman(sceneId, "ÇëÁôÏÂQQºÅÂë¸øËûÃÇ.....")
	end
end

--**********************************
--¸±±¾³¡¾°¶¨Ê±Æ÷ÊÂ¼ş
--**********************************
function x000179_OnCopySceneTimer( sceneId, nowTime )
	
	local nStep = LuaFnGetCopySceneData_Param(sceneId, x000179_g_SceneData_1);
	--PrintNum(nStep)
	-- nStep == 12 Ğúng¸±±¾ÈÎÎñth¤t bÕi±ê¼Ç,½øÈëµ½ÕâÀï,Íæ¼ÒÖ»ÄÜ³ö¸±±¾ÁË,Ã»ÓĞ±ğtoÕ ğµ ÊÂÇé¿É×÷
	if nStep == 13  then
		-- Ö´ĞĞ10 giâyºó°ÑÍæ¼Ò´«³ö³¡¾°toÕ ğµ Âß¼­
		return
	end
	--PrintNum(nStep)
	-- ÔÀÀÏÈı°éËæĞ¡¹ÖtoÕ ğµ ÅúÊı	
	local nTime = LuaFnGetCurrentTime()

	if nStep == 0  then
		x000179_CreateMonster_1(sceneId)
	end
	
	--  ğÕt ğßşcÉÏmµt ´ÎtoÕ ğµ H® th¯ngÌáÊ¾Ê±¼ä
	local nPreSystemTime = LuaFnGetCopySceneData_Param(sceneId, x000179_g_SystemTipsTime)
	if nStep == 1  then
		if nTime-nPreSystemTime >= 15  then
			x000179_SystemTips( sceneId, 1 )
			LuaFnSetCopySceneData_Param(sceneId, x000179_g_SystemTipsTime, nTime)
		end
	end
	
	if nStep == 2  then
		x000179_CreateMonster_2(sceneId)
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_SceneData_1, 3)
	end
		
	if nStep == 4  then
		x000179_CreateMonster_3(sceneId)
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_SceneData_1, 5)
	end
	
	if nStep == 6  then
		x000179_CreateMonster_5(sceneId)
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_SceneData_1, 7)
	end
	
	-- ¶ÎÑÓÇìËÀÍö,É¾³ı "mµt Æ·ÌÃÎäÊ¿","Ò¶¶şÄï","ÔÆÖĞº×"
	if nStep == 9  then
		--PrintNum(nStep)
		x000179_ClearMonsterByName(sceneId, "mµt Æ·ÌÃÎäÊ¿")
		x000179_TipAllHuman(sceneId, "½©Ê¬Í·Ä¿Õ½°Ü,à¶†ªÃÇ²»¹¥×ÔÆÆ.")
		
		x000179_ClearMonsterByName(sceneId, "Ò¶¶şÄï")
		x000179_ClearMonsterByName(sceneId, "ÔÆÖĞº×")
		
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_SceneData_1, 10)
	end

	--  ğÕt ğßşcÉÏmµt ´ÎtoÕ ğµ H® th¯ngÌáÊ¾Ê±¼ä
	local nPreSystemTime = LuaFnGetCopySceneData_Param(sceneId, x000179_g_SystemTipsTime)
	if nStep == 10  then
		if nTime-nPreSystemTime >= 15  then
			x000179_SystemTips( sceneId, 2 )
			LuaFnSetCopySceneData_Param(sceneId, x000179_g_SystemTipsTime, nTime)
		end
	end
	
	-- Ë¢°´ÕÕÂ·ÏßÑ²ÂßtoÕ ğµ Ğ¡¹Ö
	if nStep == 11  then
		local nStep1 = LuaFnGetCopySceneData_Param(sceneId, x000179_g_SD_Monster_2)
		local nPreTime=LuaFnGetCopySceneData_Param(sceneId, x000179_g_SD_Monster_2_T)
		
		if nStep1 == 0  then
			-- ×ª»» Ç®ºêÓî toÕ ğµ ÕóÓª
			local nNpcNum = GetMonsterCount(sceneId)
			for i=0, nNpcNum-1 do
				local nNpcId = GetMonsterObjID(sceneId,i)
				if GetName(sceneId, nNpcId)  == "Ç®ºêÓî"  then
					SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
				end
			end
		end
		
		if nStep1 < 10  then
			if nTime-nPreTime >= 30  then
			--if nTime-nPreTime >= 1  then
				LuaFnSetCopySceneData_Param(sceneId, x000179_g_SD_Monster_2, nStep1+1)
				LuaFnSetCopySceneData_Param(sceneId, x000179_g_SD_Monster_2_T,nTime)
				-- Ë¢¹Ö
				x000179_CreateMonster_7_1(sceneId)
				x000179_CreateMonster_7_3(sceneId)
				
				x000179_TipAllHuman(sceneId, "¾¯Ìè£¡µÚ" .. nStep1+1 .. "²¨½©Ê¬ÒÑ¾­¸ÏÖÁ,»¹ÓĞ" .. 25-(nStep1+1) .. "²¨½©Ê¬Ô®¾ü¼´½«¸ÏÀ´.")
				
				-- Ë¢ Ò¦²®µ±
				if nStep1==9  then
					x000179_CreateMonster_8(sceneId, 1)
				end
				
			end
		end
				
		
		-- Ë¢10²¨Ğ¡¹Öºó,C¥n ÓĞmµt cái90 giâytoÕ ğµ µÈ´ıÊ±¼ä
		if nStep1 == 10  then
			if nTime-nPreTime >= 90  then
				LuaFnSetCopySceneData_Param(sceneId, x000179_g_SD_Monster_2, nStep1+1)
			end
		end
		
		if nStep1>=11 and nStep1<21  then
			if nTime-nPreTime >= 60  then
			--if nTime-nPreTime >= 1  then
				LuaFnSetCopySceneData_Param(sceneId, x000179_g_SD_Monster_2, nStep1+1)
				LuaFnSetCopySceneData_Param(sceneId, x000179_g_SD_Monster_2_T,nTime)
				
				-- Ë¢¹Ö
				x000179_CreateMonster_7_4(sceneId)
				x000179_CreateMonster_7_3(sceneId)
				x000179_TipAllHuman(sceneId, "¾¯Ìè£¡µÚ" .. nStep1 .. "²¨½©Ê¬ÒÑ¾­¸ÏÖÁ,»¹ÓĞ" .. 25-(nStep1) .. "²¨½©Ê¬¼´½«¸ÏÀ´.")
				
				if nStep1==20  then
					-- Ë¢ Ë¾ÂíÁÖ
					x000179_CreateMonster_8(sceneId, 2)
				end
				
			end
		end
		
		-- ÔÙ´ÎË¢10²¨Ğ¡¹Öºó,ÔÙÓĞmµt cái90 giâytoÕ ğµ µÈ´ıÊ±¼ä
		if nStep1 == 21  then
			if nTime-nPreTime >= 90  then
				LuaFnSetCopySceneData_Param(sceneId, x000179_g_SD_Monster_2, nStep1+1)
			end
		end
		
		if nStep1>=22 and nStep1<27  then
			if nTime-nPreTime >= 90  then
				LuaFnSetCopySceneData_Param(sceneId, x000179_g_SD_Monster_2, nStep1+1)
				LuaFnSetCopySceneData_Param(sceneId, x000179_g_SD_Monster_2_T,nTime)
				x000179_CreateMonster_7_2(sceneId)
				x000179_TipAllHuman(sceneId, "¾¯Ìè£¡µÚ" .. nStep1-1 .. "²¨½©Ê¬ÒÑ¾­¸ÏÖÁ,»¹ÓĞ" .. 25-(nStep1-1) .. "²¨½©Ê¬¼´½«¸ÏÀ´.")
				
				if nStep1==26  then
					-- Ë¢ Cßu Ma Trí
					x000179_CreateMonster_8(sceneId, 3)
					-- 
					LuaFnSetCopySceneData_Param(sceneId, x000179_g_SceneData_1, 12)
				end
				
			end
		end
	end
	
	
	-- ´ò°ÜCßu Ma Trí,¼ì²âÇ®ºêÓîĞúng²»Ğúng»¹»î×Å,¿´µÚ¶ş²½Ğúng³É¹¦»¹Ğúngth¤t bÕiÁË
	if nStep == 12  then
		local nNpcNum = GetMonsterCount(sceneId)
		local bOK = 0
		for i=0, nNpcNum-1 do
			local nNpcId = GetMonsterObjID(sceneId,i)
			if GetName(sceneId, nNpcId)  == "Ç®ºêÓî"  then
				bOK = 1
			end
		end
		
		if bOK == 1  then
			LuaFnSetCopySceneData_Param(sceneId, x000179_g_SceneData_1, 15)
			-- Ë¢4ÃÅÉñ
			x000179_CreateMonster_9(sceneId)
			x000179_CreateMonster_10(sceneId)
			x000179_CreateMonster_11(sceneId)
			
			--Mµ Dung PhøcÉíºótoÕ ğµ ¹Ö
			x000179_CreateMonster_13(sceneId)
		else
			LuaFnSetCopySceneData_Param(sceneId, x000179_g_SceneData_1, 501)
		end
	end
	
	-- 500 ,th¤t bÕiÌõ¼ş1,ºôÑÓ±ª ËÀÍö
	local nLost = LuaFnGetCopySceneData_Param(sceneId, x000179_g_MissionLost)
	if nLost == 500  then
		CallScriptFunction((200060), "Paopao",sceneId, "ºôÑÓÇì", "Ñà×ÓÎë", "ÓÉÓÚºôÑÓ±ª½«¾üÕ½°Ü,¸Ã´ÎÌÖ·¥ĞĞ¶¯Ê§Àû,ÎÒÃÇÍË»ØÈ¥,´ıÖØÕûÆì¹ÄÔÙÀ´.")
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_MissionLost, 1000)
	end
	
	-- 501,th¤t bÕiÌõ¼ş2,Ç®ºêÓî ËÀÍö
	if nLost == 501  then
		CallScriptFunction((200060), "Paopao",sceneId, "ºôÑÓÇì", "Ñà×ÓÎë", "ÓÉÓÚÇ®ºêÓî½«¾üÕ½°Ü,¸Ã´ÎÌÖ·¥ĞĞ¶¯Ê§Àû,ÎÒÃÇÍË»ØÈ¥,´ıÖØÕûÆì¹ÄÔÙÀ´.")
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_MissionLost, 1000)
	end
	
	local nCloaeTime = LuaFnGetCopySceneData_Param(sceneId, x000179_g_CloseTime)
	-- 1000 ,µ¹¼ÆÊ±,30 giâyºó¹Ø±Õ¸±±¾
	if nLost == 1000 then
		x000179_TipAllHuman(sceneId, "¸±±¾½«TÕi 30 giâyºó¹Ø±Õ.")
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_CloseTime, nTime)
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_MissionLost, nLost+1)
	end
	if nLost == 1001 and nTime-nCloaeTime>=15  then
		x000179_TipAllHuman(sceneId, "¸±±¾½«TÕi 15 giâyºó¹Ø±Õ.")
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_CloseTime, nTime)
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_MissionLost, nLost+1)
	end
	if nLost == 1002 and nTime-nCloaeTime>=10  then
		x000179_TipAllHuman(sceneId, "¸±±¾½«TÕi 5 giâyºó¹Ø±Õ.")
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_CloseTime, nTime)
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_MissionLost, nLost+1)
	end
	if nLost == 1003 and nTime-nCloaeTime>=5  then
		local nHumanNum = LuaFnGetCopyScene_HumanCount(sceneId)
		for i=0, nHumanNum-1  do
			local nPlayerId = LuaFnGetCopyScene_HumanObjId(sceneId, i)
			NewWorld( sceneId, nPlayerId, x000179_g_Back_SceneId, x000179_g_Back_X, x000179_g_Back_Z) ;
		end
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_CloseTime, nTime)
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_MissionLost, nLost+1)
	end
	
	-- Á¬åóËştoÕ ğµ ĞŞÀí
	-- Èç¹ûÍæ¼Ò½»¹»ÁËÄ¾²Ä,¾Í¸Ä±äCái này ËştoÕ ğµ ÕóÓª
	local jianta1 = LuaFnGetCopySceneData_Param(sceneId, x000179_g_SceneData_3)
	if jianta1 >= 5 and jianta1 < 1000  then
		x000179_ChangeNpc(sceneId, "Ç°Á¬åóËş")
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_SceneData_3, jianta1+1000)
	end
	local jianta2 = LuaFnGetCopySceneData_Param(sceneId, x000179_g_SceneData_4)
	if jianta2 >= 5 and jianta2 < 1000  then
		x000179_ChangeNpc(sceneId, "ºóÁ¬åóËş")
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_SceneData_4, jianta2+1000)
	end
	local jianta3 = LuaFnGetCopySceneData_Param(sceneId, x000179_g_SceneData_5)
	if jianta3 >= 10 and jianta3 < 1000  then
		x000179_ChangeNpc(sceneId, "Tr¸ li®uËş")
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_SceneData_5, jianta3+1000)
	end
	local jianta4 = LuaFnGetCopySceneData_Param(sceneId, x000179_g_SceneData_6)
	if jianta4 >= 5 and jianta4 < 1000  then
		x000179_ChangeNpc(sceneId, "ÊØÓùËş")
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_SceneData_6, jianta4+1000)
	end
	
	-- ¼¸cái¼ıËş·Å¼¼ÄÜ
	if nStep >= 11   then
		if nTime-nPreSystemTime >=5  then
			LuaFnSetCopySceneData_Param(sceneId, x000179_g_SystemTipsTime, nTime)
			if jianta1 > 1000  then
				local nNpcId = x000179_NameToId(sceneId, "Ç°Á¬åóËş")
				if nNpcId>=0  then
					if GetHp(sceneId, nNpcId) > 0  then
						--PrintStr("Ç°Á¬åóËş·Å¼¼ÄÜ")
						local x
						local z
						x,z = GetWorldPos(sceneId,nNpcId)
						LuaFnUnitUseSkill(sceneId,nNpcId,1008,nNpcId,x,z,10,0)
					end
				end
			end
			
			if jianta2 > 1000  then
				local nNpcId = x000179_NameToId(sceneId, "ºóÁ¬åóËş")
				if nNpcId>=0  then
					if GetHp(sceneId, nNpcId) > 0  then
						--PrintStr("ºóÁ¬åóËş·Å¼¼ÄÜ")
						local x
						local z
						x,z = GetWorldPos(sceneId,nNpcId)
						LuaFnUnitUseSkill(sceneId,nNpcId,1008,nNpcId,x,z,10,0)
					end
				end
			end
			
			if jianta3 > 1000  then
				local nNpcId = x000179_NameToId(sceneId, "Tr¸ li®uËş")
				if nNpcId>=0  then
					if GetHp(sceneId, nNpcId) > 0  then
						--PrintStr("Tr¸ li®uËş·Å¼¼ÄÜ")
						local x
						local z
						x,z = GetWorldPos(sceneId,nNpcId)
						LuaFnUnitUseSkill(sceneId,nNpcId,1010,nNpcId,x,z,10,0)
					end
				end
			end
			
			if jianta4 > 1000  then
				local nNpcId = x000179_NameToId(sceneId, "ÊØÓùËş")
				if nNpcId>=0  then
					if GetHp(sceneId, nNpcId) > 0  then
						--PrintStr("ÊØÓùËş·Å¼¼ÄÜ")
						local x
						local z
						x,z = GetWorldPos(sceneId,nNpcId)
						LuaFnUnitUseSkill(sceneId,nNpcId,1009,nNpcId,x,z,10,0)
					end
				end
			end
			
		end
	end
	
	-- ÍõÓïæÌ ği¬mÃû
	-- ÍõÓïÑÔ¿ªÊ¼ ği¬mÃûtoÕ ğµ ¿ª¹Ø
	-- x000179_g_bWangyuyanSpeak = 24
	-- x000179_g_bWangyuyanSpeak_T = 27
	local bSpeak = LuaFnGetCopySceneData_Param(sceneId, x000179_g_bWangyuyanSpeak)
	local nSpeakTime = LuaFnGetCopySceneData_Param(sceneId, x000179_g_bWangyuyanSpeak_T)
	if bSpeak == 1  then
		CallScriptFunction((200060), "Paopao",sceneId, "ÍõÓïæÌ", "Ñà×ÓÎë", "ÓĞË­ÈÃÎÒÇ×ÃÜ½Ó´¥mµt ÏÂ£¿")
		
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_bWangyuyanSpeak, 2)
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_bWangyuyanSpeak_T, nTime)
	
	elseif bSpeak == 2 and nTime - nSpeakTime >= 1  then
		CallScriptFunction((200060), "Paopao",sceneId, "Ğoàn Dñ", "Ñà×ÓÎë", "ÎÒ,ÎÒ,ÎÒ......¡£#70")
		
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_bWangyuyanSpeak, 3)
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_bWangyuyanSpeak_T, nTime)
		
		local nNpcNum = GetMonsterCount(sceneId)
		for i=0, nNpcNum-1 do
			local nNpcId = GetMonsterObjID(sceneId,i)
			if GetName(sceneId, nNpcId)  == "Ğoàn Dñ"  then
				SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
				SetUnitCampID(sceneId, nNpcId, nNpcId, 110)
				SetNPCAIType(sceneId, nNpcId, 27)
				SetAIScriptID(sceneId, nNpcId, 245)
				--PrintNum(222)
			end
			if GetName(sceneId, nNpcId)  == "ÍõÓïæÌ"  then
				SetMonsterFightWithNpcFlag(sceneId, nNpcId, 0)
				SetUnitCampID(sceneId, nNpcId, nNpcId, 110)
			end
		end
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_bWangyuyanSpeak, 3)

	elseif bSpeak == 3 and nTime - nSpeakTime >= 20  then
		CallScriptFunction((200060), "Paopao",sceneId, "Ğoàn Dñ", "Ñà×ÓÎë", "#18#18#18ÕæĞúng²»ºÃÒâË¼,Äã¿´ÎÒÕâÁùÂöÉñ½£Ê±LinhÊ±²»LinhtoÕ ğµ ,ÏÖTÕi ÔõÃ´Ò²ÉË²»ÁËÈË¡­¡­")
	
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_bWangyuyanSpeak, 4)
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_bWangyuyanSpeak_T, nTime)
	
	elseif bSpeak == 4 and nTime - nSpeakTime >= 1  then
		CallScriptFunction((200060), "Paopao",sceneId, "ÍõÓïæÌ", "Ñà×ÓÎë", "#20#20#20ÓÖÀ´ÕâÌ×¡­¡­»¹ĞúngÎÒ×Ô¼ºÀ´°ï±í¸ç.")
	
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_bWangyuyanSpeak, 5)
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_bWangyuyanSpeak_T, nTime)
	
	elseif bSpeak == 5  then
		if nTime-nSpeakTime >= 10  then
			x000179_GiveDirections(sceneId)
			LuaFnSetCopySceneData_Param(sceneId, x000179_g_bWangyuyanSpeak_T, nTime)
		end
		
--	else
--		local nNpcNum = GetMonsterCount(sceneId)
--		for i=0, nNpcNum-1 do
--			local nNpcId = GetMonsterObjID(sceneId,i)
--			if GetName(sceneId, nNpcId)  == "Ğoàn Dñ"  then
--				SetMonsterFightWithNpcFlag(sceneId, nNpcId, 0)
--				SetUnitCampID(sceneId, nNpcId, nNpcId, 109)
--				--PrintNum(222)
--			end
--			if GetName(sceneId, nNpcId)  == "ÍõÓïæÌ"  then
--				SetMonsterFightWithNpcFlag(sceneId, nNpcId, 0)
--				SetUnitCampID(sceneId, nNpcId, nNpcId, 109)
--			end
--		end
		
	end
	
	local bSpeak = LuaFnGetCopySceneData_Param(sceneId, x000179_g_DuanAndWangFlag)
 	if bSpeak == 1 then
		CallScriptFunction((200060), "Paopao",sceneId, "ÍõÓïæÌ", "Ñà×ÓÎë", "±í¸ç,¾ÈÎÒ!")
		CallScriptFunction((200060), "Paopao",sceneId, "Ğoàn Dñ", "Ñà×ÓÎë", "Íõ¹ÃÄï,ÎÒÀ´¾ÈÄã!")
 		
		local nNpcNum = GetMonsterCount(sceneId)
		for i=0, nNpcNum-1 do
			local nNpcId = GetMonsterObjID(sceneId,i)
			if GetName(sceneId, nNpcId)  == "Ğoàn Dñ"  then
				SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
				SetUnitCampID(sceneId, nNpcId, nNpcId, 110)
				SetAIScriptID(sceneId, nNpcId, 246)
				--PrintNum(222)
			end
		end
 		LuaFnSetCopySceneData_Param(sceneId, x000179_g_DuanAndWangFlag, 2)
 	end
	
	
end

--**********************************
--´ÓTên ğÕt ğßşcNpcId
--**********************************
function x000179_NameToId(sceneId, szName)
	local nNpcId = -1
	local nMonsterNum = GetMonsterCount(sceneId)
	for i=0, nMonsterNum-1 do
		local nMonsterId = GetMonsterObjID(sceneId,i)
		if GetName(sceneId, nMonsterId)== szName  then
			nNpcId = nMonsterId
		end
	end
	return nNpcId
end

--**********************************
--µÚmµt ´ÎÉú³É¹ÖÎï
--**********************************
function x000179_CreateMonster_1(sceneId)
	-- ÉèÖ giây¢¹Ö
	if LuaFnGetCopySceneData_Param(sceneId, x000179_g_SceneData_1) == 0  then
		
		-- Ë¢Ğ¡¹Ö, ËÎ¾üÊ¿±ø,mµt Æ·ÌÃÎäÊ¿,Ñà×ÓÎë¼Ò¶¡
		for i, Npc in x000179_g_Npc_1  do
			local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y,	Npc.ai, Npc.af, -1)
			local szName = GetName(sceneId, nNpcId)
			SetUnitCampID(sceneId,nNpcId,nNpcId,Npc.camp)
			
			if szName == "ËÎ¾üÊ¿±ø"  then
				SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
				
			elseif szName == "mµt Æ·ÌÃÎäÊ¿"  then
				SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
				
			elseif szName == "Ñà×ÓÎë¼Ò¶¡"  then
				SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
			end
		end
		
		-- Ë¢Npc,ÓĞ½Å±¾toÕ ğµ Npc
		for i, Npc in x000179_g_Npc_2  do
			local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
			SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
			SetMonsterFightWithNpcFlag(sceneId, nNpcId, 0)
		end
		
		for i, Npc in x000179_g_Npc_2_1  do
			local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
			SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
			SetMonsterFightWithNpcFlag(sceneId, nNpcId, 0)
		end
		
		-- Ë¢Ç®ºêÓî
		for i, Npc in x000179_g_Npc_6  do
			local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
			SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
			SetMonsterFightWithNpcFlag(sceneId, nNpcId, 0)
		end
		
		-- Ë¢Á¬åóËş
		for i, Npc in x000179_g_Npc_7  do
			local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
			SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
			SetMonsterFightWithNpcFlag(sceneId, nNpcId, 0)
			local szName = GetName(sceneId, nNpcId)
			SetCharacterName(sceneId, nNpcId, Npc.name .. szName )
		end
	
		-- ¼ÇÂ¼ÏÂµÚmµt Åú¹ÖÒÑ¾­Ë¢Íæ
		LuaFnSetCopySceneData_Param(sceneId, x000179_g_SceneData_1, 1) 
		
	end
	
end

--**********************************
-- Éú³ÉÔÀÀÏÈı
--**********************************
function x000179_CreateMonster_2(sceneId)
	for i, Npc in x000179_g_Npc_3  do
		local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
		if GetName(sceneId,nNpcId) == "ÔÀÀÏÈı"   then
			LuaFnNpcChat(sceneId, nNpcId, 0, "¹·¹Ù,ÎÒÔÀÀÏ¶şÀ´É±ÄãÀ²,¸Ï½ô°ÑÄÔ´üÉì¹ıÀ´,ÈÃÎÒ†Uàêmµt ÉùÅ¡¶ÏCüa ngß½i ²±×Ó.")
		end
	end
	
	x000179_CreateMonster_6(sceneId)
	
	-- ×ª»» ºôÑÓ±ª toÕ ğµ ÕóÓª
	local nNpcNum = GetMonsterCount(sceneId)
	for i=0, nNpcNum-1 do
		local nNpcId = GetMonsterObjID(sceneId,i)
		if GetName(sceneId, nNpcId)  == "ºôÑÓ±ª"  then
			SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
			return
		end
	end
end

--**********************************
-- ÔÀÀÏÈıËÀ,´´½¨ Ò¶¶şÄï,ÔÆÖĞºÍ
--**********************************
function x000179_CreateMonster_3(sceneId)
	for i, Npc in x000179_g_Npc_4  do
		local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
	end
	x000179_CreateMonster_6(sceneId)
end

--**********************************
-- Ò¶¶şÄï,ÔÆÖĞºÍ Á½ÈËÆäÖĞmµt cáiËÀÁË,Ë¢¶ÎÑÓÇì
--**********************************
function x000179_CreateMonster_5(sceneId)
	for i, Npc in x000179_g_Npc_5  do
		local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
	end
	x000179_CreateMonster_6(sceneId)
end

--**********************************
-- ĞŞÀí¼ıËş
--**********************************
function x000179_ChangeNpc(sceneId, szName)
	local nNpcNum = GetMonsterCount(sceneId)
	for i=0, nNpcNum-1 do
		local nNpcId = GetMonsterObjID(sceneId,i)
		if GetName(sceneId, nNpcId)  == szName  then
			SetUnitCampID(sceneId,nNpcId, nNpcId, 109)
			SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
			LuaFnNpcChat(sceneId, nNpcId, 0, szName .. "ÎÒ±»ĞŞÀíºÃÁË.")
		end
	end
end

--**********************************
-- Éú³ÉÔÀÀÏÈıÖ®ºó,°éËæË¢³ötoÕ ğµ Ğ¡¹Ö
--**********************************
function x000179_CreateMonster_6(sceneId)
	for i, Npc in x000179_g_Npc_8  do
		local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
	end
end

--**********************************
-- ºÍºêÓî¶Ô»°ºóË¢toÕ ğµ ¹Ö,1
--**********************************
function x000179_CreateMonster_7_1(sceneId)
	for i, Npc in x000179_g_Npc_9  do
		local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
		SetPatrolId(sceneId, nNpcId, Npc.pp)
	end
end

--**********************************
-- ºÍºêÓî¶Ô»°ºó,TÕi Å¼Êı´ÎË¢³ötoÕ ğµ Ä¾ÈË¿şÀÜ
--**********************************
function x000179_CreateMonster_7_3(sceneId)
	for i, Npc in x000179_g_Npc_9_1  do
		local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
		SetPatrolId(sceneId, nNpcId, Npc.pp)
	end
end


--**********************************
-- ºÍºêÓî¶Ô»°ºó,TÕi 50-100²¨Ë¢³ötoÕ ğµ Çà³ÇÅÉµÜ×Ó
--**********************************
function x000179_CreateMonster_7_4(sceneId)
	for i, Npc in x000179_g_Npc_9_2  do
		local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
		SetPatrolId(sceneId, nNpcId, Npc.pp)
	end
end

--**********************************
-- ºÍºêÓî¶Ô»°ºóË¢toÕ ğµ ¹Ö,2
--**********************************
function x000179_CreateMonster_7_2(sceneId)
	for i, Npc in x000179_g_Npc_10  do
		local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
		SetPatrolId(sceneId, nNpcId, Npc.pp)
	end
end

--**********************************
-- ºÍºêÓî¶Ô»°ºó Ë¢ Ò¦²®µ± Ë¾ÂíÁÖ Cßu Ma Trí
--**********************************
function x000179_CreateMonster_8(sceneId, nIndex)
	local Npc = x000179_g_Npc_11[nIndex]
	local nNpcId
	if nIndex == 3  then
		nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
	else
		nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
	end
	SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
	SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
	SetPatrolId(sceneId, nNpcId, Npc.pp)
end

--**********************************
-- Ë¢4ÃÅÉñ
--**********************************
function x000179_CreateMonster_9(sceneId)
	for i, Npc in x000179_g_Npc_12  do
		local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId, nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
		
		SetMonsterGroupID(sceneId, nNpcId, 99)
	end
end

--**********************************
-- Ë¢ ×Üboss Mµ Dung Phøc
--**********************************
function x000179_CreateMonster_10(sceneId)
	for i, Npc in x000179_g_Npc_13  do
		local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
	end
end

--**********************************
-- Ë¢ ÍõÓïæÌ  Ğoàn Dñ
--**********************************
function x000179_CreateMonster_11(sceneId)
	for i, Npc in x000179_g_Npc_14  do
		local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
	end
end

--**********************************
-- ºÍMµ Dung Phøc¿ª´òºó,²»¶ÏË¢³ötoÕ ğµ ¼Ò¶¡ (ÒÑ¾­É¾³ıÁËÕâĞ©¹Ö,²»ÔÙË¢ÁË)
--**********************************
function x000179_CreateMonster_12(sceneId)
	for i, Npc in x000179_g_Npc_15  do
		local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
	end
end

--**********************************
-- Mµ Dung Phøc ÉíºótoÕ ğµ ¼Ò¶¡ (ÒÑ¾­É¾³ıÁËÕâĞ©¹Ö,²»ÔÙË¢ÁË)
--**********************************
function x000179_CreateMonster_13(sceneId)
	for i, Npc in x000179_g_Npc_16  do
		local nNpcId = x000179_CreateNpc(sceneId, Npc.id, Npc.x, Npc.y, Npc.ai, Npc.af, Npc.script)
		SetUnitCampID(sceneId,nNpcId, nNpcId, Npc.camp)
		SetMonsterFightWithNpcFlag(sceneId, nNpcId, 1)
	end
end

--**********************************
-- Çå³ı³¡¾°ÄÚtoÕ ğµ XX¹Ö
--**********************************
function x000179_ClearMonsterByName(sceneId, szName)
	local nMonsterNum = GetMonsterCount(sceneId)
	for i=0, nMonsterNum-1 do
		local nMonsterId = GetMonsterObjID(sceneId,i)
		if GetName(sceneId, nMonsterId)== szName  then
			LuaFnDeleteMonster(sceneId, nMonsterId)
		end
	end
end

--**********************************
-- ÍõÓïæÌtoÕ ğµ  ği¬mÃû
--**********************************
function x000179_GiveDirections(sceneId)
	-- ÏÈ¿´ÍõÓïæÌĞúng²»Ğúng»¹»î×Å
	local nWangId = -1
	local nMonsterNum = GetMonsterCount(sceneId)
	for i=0, nMonsterNum-1 do
		local nMonsterId = GetMonsterObjID(sceneId,i)
		if GetName(sceneId, nMonsterId)== "ÍõÓïæÌ"  then
			nWangId = nMonsterId
		end
	end
	-- ÍõÓïæÌÒÑ¾­²»TÕi ³¡¾°ÄÚ,ÎŞ·¨ ği¬mÃûÁË
	if nWangId == -1  then
		return
	end
	local nHumanCount = LuaFnGetCopyScene_HumanCount(sceneId)
	local nRand = random( 1, nHumanCount ) - 1
	local nHumanId = LuaFnGetCopyScene_HumanObjId(sceneId,nRand)
	-- C¥n ¼ì²âÍæ¼ÒĞúng²»Ğúng´¦ÓÚËÀÍö×´Ì¬,ËÀÍö×´Ì¬²»ÄÜ¼Ó buff
	
	LuaFnSendSpecificImpactToUnit(sceneId, nWangId, nWangId, nHumanId, 10188, 2000 )
	local szHumanName = GetName(sceneId, nHumanId)
	local str1 = "ÍõÓïæÌ°ÑÄ¿¹âÍ¶ÏòÁË#H¡¾" .. szHumanName .. "¡¿"
	
	local str = x000179_GetDirectionsDesc(GetMenPai(sceneId, nHumanId))
	CallScriptFunction((200060), "Paopao",sceneId, "ÍõÓïæÌ", "Ñà×ÓÎë", str)
	
	x000179_TipAllHuman(sceneId, str1)
end

--**********************************
-- Í¨ÓÃ´´½¨¹ÖÎïº¯Êı
--**********************************
function x000179_CreateNpc(sceneId, NpcId, x, y, Ai, AiFile, Script)
	local PlayerLevel = LuaFnGetCopySceneData_Param(sceneId, x000179_g_SceneData_7)
	local ModifyLevel = 0
	if PlayerLevel >= 10   then
		ModifyLevel = 1
	end
	if PlayerLevel >= 20   then
		ModifyLevel = 2
	end
	if PlayerLevel >= 30   then
		ModifyLevel = 3
	end
	if PlayerLevel >= 40   then
		ModifyLevel = 4
	end
	if PlayerLevel >= 50   then
		ModifyLevel = 5
	end
	if PlayerLevel >= 60   then
		ModifyLevel = 6
	end
	if PlayerLevel >= 70   then
		ModifyLevel = 7
	end
	if PlayerLevel >= 80   then
		ModifyLevel = 8
	end
	if PlayerLevel >= 90   then
		ModifyLevel = 9
	end
	--npcµÈ¼¶À©Õ¹ÖÁ200
	if PlayerLevel >= 100   then         
		ModifyLevel = 30001
	end
	if PlayerLevel >= 110   then         
		ModifyLevel = 30002
	end
	if PlayerLevel >= 120   then         
		ModifyLevel = 30003
	end
	if PlayerLevel >= 130   then         
		ModifyLevel = 30004
	end
	if PlayerLevel >= 140   then         
		ModifyLevel = 30005
	end
	local nNpcId = NpcId + ModifyLevel-1
	local nMonsterId = LuaFnCreateMonster(sceneId, nNpcId, x, y, Ai, AiFile, Script)
	SetLevel(sceneId, nMonsterId, PlayerLevel)
	
	-- ¿´ÓĞÃ»ÓĞÉèÖÃ³ÆºÅ,ÓĞ¾Í¼Ó³ÆºÅ
	x000179_SetNpcTitle(sceneId, nMonsterId)
	
	return nMonsterId
end

--**********************************
-- ÃÅÅÉIdµ½ÃÅÅÉÃû³Æ
--**********************************
function x000179_GetDirectionsDesc(MenpaiId)
	
	local str = ""

	if MenpaiId == 0  then
		str = "±í¸ç,Thiªu LâmµÜ×ÓtoÕ ğµ Èõ ği¬mTÕi ´ó×µÑ¨!"
	elseif MenpaiId == 1  then
		str = "±í¸ç,Minh GiáoµÜ×ÓtoÕ ğµ Èõ ği¬mTÕi LinhÌ¨Ñ¨!"
	elseif MenpaiId == 2  then
		str = "±í¸ç,Cái BangµÜ×ÓtoÕ ğµ Èõ ği¬mTÕi ĞüÊàÑ¨!"
	elseif MenpaiId == 3  then
		str = "±í¸ç,Võ ĞangµÜ×ÓtoÕ ğµ Èõ ği¬mTÕi °Ù»áÑ¨!"
	elseif MenpaiId == 4  then
		str = "±í¸ç,Nga MyµÜ×ÓtoÕ ğµ Èõ ği¬mTÕi ÉñÍ¥Ñ¨!"
	elseif MenpaiId == 5  then
		str = "±í¸ç,Tinh TúcµÜ×ÓtoÕ ğµ Èõ ği¬mTÕi Ì«ÑôÑ¨!"
	elseif MenpaiId == 6  then
		str = "±í¸ç,Thiên LongµÜ×ÓtoÕ ğµ Èõ ği¬mTÕi ëşÖĞÑ¨!"
	elseif MenpaiId == 7  then
		str = "±í¸ç,Thiên S½nµÜ×ÓtoÕ ğµ Èõ ği¬mTÕi ğ¯Î²Ñ¨!"
	elseif MenpaiId == 8  then
		str = "±í¸ç,Tiêu DaoµÜ×ÓtoÕ ğµ Èõ ği¬mTÕi ÉÌÇúÑ¨!"
	end
	
	return str
end

--**********************************
-- ÃÅÅÉIdµ½ÃÅÅÉÃû³Æ
--**********************************
function x000179_SetNpcTitle(sceneId, nNpcId)
	
	local szName = GetName(sceneId, nNpcId)
	
	if szName == "ºôÑÓÇì"   then
		SetCharacterTitle(sceneId, nNpcId, "Thái H°Ë®¾ü´ó¶¼¶½")
	elseif szName == "ºôÑÓ±ª"   then
		SetCharacterTitle(sceneId, nNpcId, "Ë®¾üÏÈ·æ")
	elseif szName == "Ç®ºêÓî"   then
		SetCharacterTitle(sceneId, nNpcId, "Tô ChâuĞ£Î¾")
	elseif szName == "ÔÀÀÏÈı"   then
		SetCharacterTitle(sceneId, nNpcId, "¡°Ğ×Éñ¶ñÉ·¡±")
	elseif szName == "Ò¶¶şÄï"   then
		SetCharacterTitle(sceneId, nNpcId, "¡°ÎŞ¶ñ²»×÷¡±")
	elseif szName == "ÔÆÖĞº×"   then
		SetCharacterTitle(sceneId, nNpcId, "¡°ÇîĞ×¼«¶ñ¡±")
	elseif szName == "¶ÎÑÓÇì"   then
		SetCharacterTitle(sceneId, nNpcId, "¡°¶ñ¹áÂúÓ¯¡±")
	elseif szName == "Ò¦²®µ±"   then
		SetCharacterTitle(sceneId, nNpcId, "ÇØ¼ÒÕ¯Õ¯Ö÷")
	elseif szName == "Ë¾ÂíÁÖ"   then
		SetCharacterTitle(sceneId, nNpcId, "Çà³ÇÅÉÕÆÃÅ")
	elseif szName == "Cßu Ma Trí"   then
		SetCharacterTitle(sceneId, nNpcId, "´óÂÖÃ÷Íõ")
	elseif szName == "Mµ Dung Phøc"   then
		SetCharacterTitle(sceneId, nNpcId, "¡°¶·×ªĞÇÒÆ¡±")
	
	end
end


